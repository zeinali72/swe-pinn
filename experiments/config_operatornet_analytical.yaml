# experiments/config_operatornet_analytical.yaml
#
# Configuration for the Physics-Informed OperatorNet (e.g., DeepONet)
# on the analytical (no-building) scenario.

data_free: true # This model is always physics-informed

training:
  learning_rate: 0.0005
  epochs: 30_000
  batch_size: 1024 # Batch size for each loss term (PDE, IC, BC)
  seed: 42
  lr_boundaries:
    15000: 0.1
    25000: 0.1
  log_freq_steps: 100

model:
  name: "OperatorNet"
  output_dim: 3
  latent_dim: 128      # Latent dimension (p)
  branch_width: 128
  branch_depth: 4
  trunk_width: 128
  trunk_depth: 4
  bias_init: 0.0

domain:
  lx: 1200.0
  ly: 100.0
  t_final: 3600.0

# --- Sampling for Physics Losses (Trunk) ---
grid:
  nx: 50
  ny: 10
  nt: 50
ic_bc_grid:
  nx_ic: 50
  ny_ic: 50
  ny_bc_left: 25
  nt_bc_left: 25
  ny_bc_right: 25
  nt_bc_right: 25
  nx_bc_bottom: 50
  nt_bc_other: 25
  nx_bc_top: 50

# --- Sampling for Validation (Branch & Trunk) ---
validation_sampling:
  n_val_functions: 50       # Number of parameter sets to test
  n_val_points_per_function: 2000 # Number of (x,y,t) points for each param set

physics:
  u_const: 0.29      # Default/Fallback value
  n_manning: 0.03    # Default/Fallback value
  inflow: null
  g: 9.81
  
  # --- Parameter Bounds (Branch Inputs) ---
  param_bounds:
    # name: [min, max]
    n_manning: [0.02, 0.04]
    u_const: [0.2, 0.4]

loss_weights:
  pde_weight: 1.0
  ic_weight: 1.0
  bc_weight: 1.0
  neg_h_weight: 1.0
  # data_weight and building_bc_weight are not used

gradnorm:
  enable: false # Set to true to enable GradNorm
  learning_rate: 0.01
  alpha: 1.5
  update_freq: 100

plotting:
  nx_val: 101
  t_const_val: 1800.0
  y_const_plot: 0.0 # y-coord for 1D plot

device:
  dtype: "float32"
  early_stop_min_epochs: 5000
  early_stop_patience: 5000

numerics:
  eps: 1e-6